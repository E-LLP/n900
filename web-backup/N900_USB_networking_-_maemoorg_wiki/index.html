<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" dir="ltr" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		
				<meta name="keywords" content="N900 USB networking,Extras-devel,MADDE,N900 USB router,Nokia N900,Root access,Terminal,USB,USB networking">
		<link rel="shortcut icon" href="favicon.ico">
		<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.maemo.org/opensearch_desc.php" title="maemo.org wiki (English)">
<link rel="alternate" type="application/rss+xml" title="maemo.org wiki RSS Feed" href="http://wiki.maemo.org/index.php?title=Special:Recentchanges&amp;feed=rss">
<link rel="alternate" type="application/atom+xml" title="maemo.org wiki Atom Feed" href="http://wiki.maemo.org/index.php?title=Special:Recentchanges&amp;feed=atom">
		<title>N900 USB networking - maemo.org wiki</title>
        
        
        <!--[if lte IE 6]>
            <link rel="stylesheet" href="http://static.maemo.org/style_maemo2009/css/ie.css" type="text/css" media="screen">
        <![endif]-->


        
        
		
		
		<meta http-equiv="imagetoolbar" content="no"><!--[endif]---->
		
		
                
		
		<!-- Head Scripts -->
		

		
		
	
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="mediawiki ns-0 ltr page-N900_USB_networking">
        <div id="container">
            <div id="header">
                <div id="logo">
                                        <a href="http://maemo.org/"><img src="logo.jpg" title="Maemo.org" alt="Maemo.org"></a>
                </div><!-- logo -->

	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="http://wiki.maemo.org/index.php?title=Special:Userlogin&amp;returnto=N900_USB_networking" title="You are encouraged to log in, it is not mandatory however. [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
            </div>
        </div>
            <div id="navigation">
                <div id="navigation-left-wrapper">

                    <div id="navigation-right-wrapper">

                        <ul>
                            <li><a href="http://maemo.org/intro/">Intro</a></li>
                            <li><a href="http://maemo.org/downloads/">Downloads</a></li>
                            <li class="selected"><a href="http://maemo.org/community/">Community</a></li>
                            <li><a href="http://maemo.org/development/">Development</a></li>
                            <li><a href="http://maemo.org/news/">News</a></li>
                            <li><a href="http://talk.maemo.org/">TALK</a></li>
                        </ul>


		<div id="search">
			<form action="http://wiki.maemo.org/Special:Search" id="searchform">
				<input id="searchInput" name="search" title="Search maemo.org wiki [f]" accesskey="f" value="" type="text">
				<input name="go" class="submit" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists" type="submit">&nbsp;
<!--				<input type='submit' name="fulltext" class="submit" id="mw-searchButton" value="Go" title="Search the pages for this text" /> &nbsp; -->
			</form>
		</div>


                    </div>
                </div>
            </div><!-- /navigation -->
            <div id="breadcrumb"></div>
            <div id="content">
                        

<!--	<div id="globalWrapper">
		<div id="column-content">
	<div id="content2"> 


		<a name="top" id="top"></a>
				<h1 class="firstHeading">N900 USB networking</h1>
		<div id="bodyContent">
-->

      
<!-- sidebar --> 
                  <div id="sidebar">
		<div id="nav-sub">

		<div class="portlet" id="p-navigation">
		<h3>Navigation</h3>
			<ul>
				<li id="n-mainpage"><a href="http://wiki.maemo.org/Main_Page" title="Visit the Main Page [z]" accesskey="z">Main Page</a></li>
				<li id="n-recentchanges"><a href="http://wiki.maemo.org/Special:Recentchanges" title="The list of recent changes in the wiki. [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="http://wiki.maemo.org/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="http://wiki.maemo.org/Help:Contents" title="The place to find out.">Help</a></li>
				<li id="n-advancedsearch"><a href="http://wiki.maemo.org/Special:Search">Advanced search</a></li>
			</ul>
	</div>
	


	<div id="p-cactions" class="portlet">
		<h3>Views</h3>
			<ul class="fi_protie_navigation">
					 <li id="ca-nstab-main" class="selected"><a href="http://wiki.maemo.org/N900_USB_networking" title="View the content page [c]" accesskey="c">Page</a></li>
					 <li id="ca-talk"><a href="http://wiki.maemo.org/Talk:N900_USB_networking" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
					 <li id="ca-edit"><a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit" title="You can edit this page. Please use the preview button before saving. [e]" accesskey="e">Edit</a></li>
					 <li id="ca-history"><a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=history" title="Past versions of this page. [h]" accesskey="h">History</a></li>
				</ul>
	</div>


    
		</div>

               </div>
<!-- sidebar --> 
<div id="main">
<div id="main-wrapper">

			            <h1 class="firstHeading">N900 USB networking</h1>
			<!-- start content -->
			<p>This page describes how to enable Networking on the <a href="http://wiki.maemo.org/Nokia_N900" title="Nokia N900">N900</a> via <a href="http://wiki.maemo.org/USB" title="USB">USB</a>. The first part describes how to configure the N900 as a USB pluggable network device. The second part describes how to configure various platforms to use the Nokia N900 as a network device. This article is based on the <a href="http://wiki.maemo.org/USB_networking" title="USB networking">Maemo 4.x USB networking article</a>. It is also possible to use the N900 as a <a href="http://wiki.maemo.org/N900_USB_router" title="N900 USB router">USB router</a>.
</p><p>You might want to use the N900 as a USB network device to log into your N900 remotely, or to transfer data from your N900 to another computer, in a situation where wifi or Bluetooth are not an option. If you wish to connect your N900 to a Linux machine over TCP/IP, the <a href="http://maemo.org/development/documentation/pc_connectivity/" class="external text" title="http://maemo.org/development/documentation/pc_connectivity/" rel="nofollow">PC connectivity</a> section in the Maemo SDK documentation also contains useful information.
</p>
<table id="toc" class="toc" summary="Contents"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#N900_USB_network_configuration"><span class="tocnumber">1</span> <span class="toctext">N900 USB network configuration</span></a>
<ul>
<li class="toclevel-2"><a href="#Starting_USB_network_mode"><span class="tocnumber">1.1</span> <span class="toctext">Starting USB network mode</span></a></li>
<li class="toclevel-2"><a href="#Stopping_USB_network_mode"><span class="tocnumber">1.2</span> <span class="toctext">Stopping USB network mode</span></a></li>
<li class="toclevel-2"><a href="#Starting_USB_network_mode_with_Windows"><span class="tocnumber">1.3</span> <span class="toctext">Starting USB network mode with Windows</span></a></li>
<li class="toclevel-2"><a href="#Fixing_the_MAC_address"><span class="tocnumber">1.4</span> <span class="toctext">Fixing the MAC address</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Host_USB_Network_Configuration"><span class="tocnumber">2</span> <span class="toctext">Host USB Network Configuration</span></a>
<ul>
<li class="toclevel-2"><a href="#Host_configuration_on_Debian_Lenny"><span class="tocnumber">2.1</span> <span class="toctext">Host configuration on Debian Lenny</span></a></li>
<li class="toclevel-2"><a href="#Automatic_configuration_with_Ubuntu_9.10.2F10.04.2F11.10"><span class="tocnumber">2.2</span> <span class="toctext">Automatic configuration with Ubuntu 9.10/10.04/11.10</span></a></li>
<li class="toclevel-2"><a href="#Host_configuration_on_Archlinux_via_netcfg"><span class="tocnumber">2.3</span> <span class="toctext">Host configuration on Archlinux via netcfg</span></a></li>
<li class="toclevel-2"><a href="#Windows"><span class="tocnumber">2.4</span> <span class="toctext">Windows</span></a></li>
<li class="toclevel-2"><a href="#Mac_OS_X"><span class="tocnumber">2.5</span> <span class="toctext">Mac OS X</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#One-time_Quick_.26_Dirty_Connection"><span class="tocnumber">3</span> <span class="toctext">One-time Quick &amp; Dirty Connection</span></a></li>
<li class="toclevel-1"><a href="#Using_USB_networking_for_Maemo_applications"><span class="tocnumber">4</span> <span class="toctext">Using USB networking for Maemo applications</span></a></li>
</ul>
</td></tr></tbody></table>
<a name="N900_USB_network_configuration"></a><h2><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=1" title="Edit section: N900 USB network configuration">edit</a>]</span> <span class="mw-headline"> N900 USB network configuration </span></h2>
<p>If you are going to use windows as your host, the configuration needed on your N900 are a little different, so skip directly to the "Starting USB network mode with Windows" Part.
</p><p>There is a default USB network interface configuration on Nokia N900. In the file <code>/etc/network/interfaces</code>, you should see a section which looks like this:
</p>
<pre>auto usb0
iface usb0 inet static
       address 192.168.2.15
       netmask 255.255.255.0
       gateway 192.168.2.14
</pre>
<p>You can also add the following lines to set the default route correctly
</p>
<pre>      up route del default
      up route add default gw  192.168.2.14
</pre>
<p>Also you can add the following lines to set the nameserver (dnsmasq will automatically change <code>/etc/resolve.conf</code>)
</p>
<pre>      dns-nameservers 8.8.8.8 8.8.4.4
</pre>
<p>and
</p>
<pre>      up run-standalone.sh dbus-send --type=method_call --system --dest=com.nokia.icd /com/nokia/icd com.nokia.icd.connect string:DUMMY uint32:0
</pre>
<pre>      down run-standalone.sh dbus-send --system --dest=com.nokia.icd /com/nokia/icd_ui com.nokia.icd_ui.disconnect boolean:true
</pre>
<p>to properly set/reset the connection manager on connection/disconnection, especially if you have set up a DUMMY network as decribed later.
</p><p><br>
With this default configuration, the N900 USB interface will have the IP address 192.168.2.15, and the remote end will have the IP address 192.168.2.14. By default, the USB network interface on the N900 is configured. You need to install the package usb-network-modules. 
</p>
<a name="Starting_USB_network_mode"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=2" title="Edit section: Starting USB network mode">edit</a>]</span> <span class="mw-headline"> Starting USB network mode </span></h3>
<p>First, set up the host (the computer at the other end of the USB connection, not the N900) to have an IP address of the gateway --in our case here, it's 192.168.2.14.  For a typical Linux computer, one might use the command "ifconfig usb0 192.168.2.14" (add "sudo" to the beginning of that command if necessary).  There may be other ways to do it for various versions of operating systems.
</p><p>Plug one end of the USB cable on the host and the other end into the N900. The N900 will bring up the mode-selection dialog. Select 'PC Suite mode'.
</p><p><br>
</p>
<div class="center"><div class="floatnone"><span><a href="http://wiki.maemo.org/Image:Mode-selection.png" class="image" title="USB Mode-Selection dialog"><img alt="USB Mode-Selection dialog" src="mode-selection.png" border="0" height="360" width="600"></a></span></div></div>
<p><br>
Open a <a href="http://wiki.maemo.org/Root_access" title="Root access">root shell</a> in <a href="http://wiki.maemo.org/Terminal" title="Terminal">X Terminal</a> on the N900 and activate the interface by executing the following:
</p>
<pre>sudo gainroot
ifup usb0
</pre>
<p>If all went well, no errors will be displayed. The command 'ifconfig usb0' will give the following output:
</p>
<pre>Nokia-N900-42-11:~# ifconfig usb0
usb0      Link encap:Ethernet  HWaddr F2:50:8F:04:1D:8B  
          inet addr:192.168.2.15  Bcast:192.168.2.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1021 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2003 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:86091 (84.0 KiB)  TX bytes:2556598 (2.4 MiB)
</pre>
<p>You should also be able to ping 192.168.2.15
</p>
<pre>Nokia-N900-42-11:~# ping 192.168.2.15
PING 192.168.2.15 (192.168.2.15): 56 data bytes
64 bytes from 192.168.2.15: seq=0 ttl=64 time=0.367 ms
64 bytes from 192.168.2.15: seq=1 ttl=64 time=0.214 ms
^C
--- 192.168.2.15 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.214/0.290/0.367 ms
</pre>
<p>To automatically setup usb0 when entering PC suite mode change the last few lines of <code>/usr/sbin/pcsuite-enable.sh</code> by adding the "ifup usb0" line.
</p>
<pre>logger "$0: sent SIGUSR1 to syncd"
ifup usb0
exit 0
</pre>
<p>And, to automatically down your usb0 interface when leaving PC suite mode, add to <code>/usr/sbin/pcsuite-disable.sh</code> 
</p>
<pre>ifdown usb0
exit 0
</pre>
<p>In fact if you want to use the `Mail to exchange' feature to synchronize mail, calendar or contacts with an exchange server (such as Google mail) the 'PC suite mode' might block the exchange. So do not use it when connected in that mode, instead choose the 'charging only' mode instead. This
mode can be achieved by choosing neither of the offers in the above menu. Simply tap above the menu to close it. This 'charging only' mode still gives you the usb0 interface provided that you initialized it
once through the 'PC suite mode'.
</p><p>If you can not ping the outside world (for example: local network works but Google does not), check your routing tables.
</p>
<pre>/home/user # route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.2.0     *               255.255.255.0   U     0      0        0 usb0
default         192.168.2.14    0.0.0.0         UG    0      0        0 usb0
default         *               0.0.0.0         U     0      0        0 gprs0
</pre>
<p>If you have a situation like above where the cell network's packets are at a lower default priority, you might have to run the following to fix it:
</p>
<pre>/home/user # route del default
/home/user # route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.2.0     *               255.255.255.0   U     0      0        0 usb0
default         *               0.0.0.0         U     0      0        0 gprs0
/home/user # ping google.com
PING google.com (74.125.45.103): 56 data bytes
64 bytes from 74.125.45.103: seq=0 ttl=51 time=257.081 ms
64 bytes from 74.125.45.103: seq=1 ttl=51 time=236.481 ms
64 bytes from 74.125.45.103: seq=2 ttl=51 time=256.226 ms
^C
--- google.com ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 236.481/249.929/257.081 ms
</pre>
<p>If after having fixed the routing table you still are not able to ping the outside world try to add a nameserver to <code>/etc/resolv.conf</code>
</p>
<pre>nameserver 127.0.0.1
# added Google DNS
nameserver 8.8.8.8
nameserver 8.8.4.4
</pre>
<a name="Stopping_USB_network_mode"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=3" title="Edit section: Stopping USB network mode">edit</a>]</span> <span class="mw-headline"> Stopping USB network mode </span></h3>
<p>This is optional. It is not necessary to stop the interface after unplugging the USB cable. 
</p><p>However, to stop the USB interface, unplug the USB cable and execute the following in 'X Terminal'
</p>
<pre>sudo gainroot
ifdown usb0
</pre>
<a name="Starting_USB_network_mode_with_Windows"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=4" title="Edit section: Starting USB network mode with Windows">edit</a>]</span> <span class="mw-headline"> Starting USB network mode with Windows </span></h3>
<p>To use the USB network mode alongside with a Windows host, you must use <a href="http://wiki.maemo.org/MADDE" title="MADDE">MADDE</a>. MADDE will not work with just changing the configuration in the <code>/etc/network/interfaces</code> file. Different modification are needed:
</p>
<ol>
<li>
Install MADDE package (actually MADDE for Windows is not required, but just files <b>maemo_usbnet.inf</b> and <b>maemo_usbnet.cat</b> for installation network device <b>Linux USB Ethernet/RNDIS Gadget</b>). 
</li>
<li>
Add the following lines to <code>/usr/sbin/pcsuite-enable.sh</code> (Do not forget to change the ip address so it matches the one configured on your host's usb port.)
<pre>run-standalone.sh dbus-send --type=method_call --system --dest=com.nokia.icd /com/nokia/icd com.nokia.icd.connect string:DUMMY uint32:0
route del default
route add default gw 192.168.2.14
</pre>
<p>so it looks like this&nbsp;:
</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="bash source-bash"><pre class="de1"><span class="kw1">if</span> <span class="br0">[</span> <span class="re1">$RC</span> <span class="sy0">!</span>= <span class="nu0">0</span> <span class="br0">]</span>; <span class="kw1">then</span>
    logger <span class="st0">"$0: failed to install g_nokia"</span>
    run-standalone.sh dbus-send <span class="re5">--type</span>=method_call <span class="re5">--system</span> <span class="re5">--dest</span>=com.nokia.icd <span class="sy0">/</span>com<span class="sy0">/</span>nokia<span class="sy0">/</span>icd com.nokia.icd.connect string:DUMMY uint32:<span class="nu0">0</span>
    route del default
    route add default gw 192.168.2.14
    <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">else</span>
    <span class="kw2">sleep</span> <span class="nu0">2</span>
<span class="kw1">fi</span></pre></div></div>
</li>
<li>
Add the following lines to <code>/usr/sbin/pcsuite-disable.sh</code> (Don't forget to change the ip...)
<pre> ifdown usb0
 run-standalone.sh dbus-send --system --dest=com.nokia.icd /com/nokia/icd_ui com.nokia.icd_ui.disconnect boolean:true
 route del default netmask 0.0.0.0 gw 192.168.2.14
</pre>
<p>So it looks like this:
</p>
<pre> logger "$0: do nothing to pass USB certs"
 ifdown usb0
 run-standalone.sh dbus-send --system --dest=com.nokia.icd /com/nokia/icd_ui com.nokia.icd_ui.disconnect boolean:true
 route del default netmask 0.0.0.0 gw 192.168.2.14
 exit 0
</pre>
</li>
<li>
This will cause the dummy network to connect when USB networking is used, right after you press the "PC Suite" button in the popup that comes after connecting the USB cable. This will only work if you got MADDE installed and configured for "Windows network". Also, a route will be added to your host machine, with Windows it is very easy to share connections. You should now have network connectivity to your PC + Internet.
</li>
<li>Once you disconnect the USB cable, the dummy network will disconnect and the route will be deleted.
</li>
<li>
Add a DNS server of your choice to <code>/etc/resolv.conf</code>, for example:
<pre>nameserver 8.8.8.8
nameserver 8.8.4.4
</pre>
</li>
</ol>
<p>Windows 7 (and probably Vista) have firewall setups based network location. This means you might run into problems trying to connect to services on your Windows boxen, because by default N900 USB Network adapter isn't known to Windows as a proper type of NDIS device. This causes Windows to put connections made over USB into "unidentified connections" category and apply Public Location firewall rules to it. Now of course you could poke all the holes into your Public firewall profile and make it look like Swiss cheese, but fortunately some VirtualBox people ran into the same thing with their loopback adapter and <a href="http://forums.virtualbox.org/viewtopic.php?p=73167#p73167" class="external text" title="http://forums.virtualbox.org/viewtopic.php?p=73167#p73167" rel="nofollow">solved it for us</a>:
</p>
<ol><li> open Registry Editor
</li><li> browse to <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\{4D36E972-E325-11CE-BFC1-08002BE10318}</code> (all network adapters are stored here)
</li><li> find your N900 USB adapter sub-key, it says the adapter name somewhere in key
</li><li> add <code>DWORD</code> key <code>*NdisDeviceType</code> with a value 1
</li></ol>
<p>Now your USB connection is considered part of Private firewall profile. Stay safe and go buy Swiss cheese in supermarket instead.
</p>
<a name="Fixing_the_MAC_address"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=5" title="Edit section: Fixing the MAC address">edit</a>]</span> <span class="mw-headline"> Fixing the MAC address </span></h3>
<p>By default, the N900 sets a random MAC address for the USB interface every time you reboot.
This makes some operating systems (Mac OS X) detect a new device whenever you connect the N900
and ask you to configure the network interface. The solutions is to set a fixed MAC address
</p>
<pre>sudo gainroot
echo options g_nokia host_addr=00:11:22:33:44:55 &gt; /etc/modprobe.d/g_nokia 
</pre>
<p>After the next reboot your N900 will always be detected as the same device.
</p>
<a name="Host_USB_Network_Configuration"></a><h2><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=6" title="Edit section: Host USB Network Configuration">edit</a>]</span> <span class="mw-headline"> Host USB Network Configuration </span></h2>
<p>The PC Host configuration is detailed in the <a href="http://wiki.maemo.org/USB_networking#Host_USB_Network_Configuration" title="USB networking">Maemo 4.x  USB Networking article</a>. Please refer to it for details.
</p><p><br>
</p>
<a name="Host_configuration_on_Debian_Lenny"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=7" title="Edit section: Host configuration on Debian Lenny">edit</a>]</span> <span class="mw-headline"> Host configuration on Debian Lenny </span></h3>
<p>Create the file in /etc/udev/rules.d/99-nokia-n900.rules and put in the following lines: 
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer}=="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="n900"
#SUBSYSTEM=="net", ACTION=="add", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer}=="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="n900p"
</pre>
<p>The second rule is commented out as it is not needed for usb networking.
A different approach uses a DEVPATH key:
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", DEVPATH=="/devices/pci0000:00/0000:00:1a.7/usb1/1-2/1-2:1.8/net/usb0", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer}=="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="n900"
SUBSYSTEM=="net", ACTION=="add", DEVPATH=="/devices/pci0000:00/0000:00:1a.7/usb1/1-2/1-2:1.0/net/usbpn0", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer}=="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="n900p"
</pre>
<p>Your DEVPATH may be different though, depending on which USB port is used on the host computer etc, so to make this work reliably you have to use always 
the same usb port.
</p><p>You can use 
</p>
<pre>udevadm monitor --kernel
</pre>
<p>while plugging in the N900 to see what is the correct path.
</p><p>Newer kernels/udev versions seem to be confused to seeing both <code>usb0</code> and <code>usbpn0</code> devices. Luckily DEVPATH accepts wildcards, so you may want to try something like:
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", DEVPATH=="*/net/usb[0-9]", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer} =="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="n900"
</pre>
<p>After adding the udev rules, you have to reload them with:
</p>
<pre>udevadm control --reload-rules
</pre>
<p>Then edit <code>/etc/network/interfaces</code> and add:
</p>
<pre>allow-hotplug n900
auto n900
iface n900 inet static
	address 192.168.2.14
	netmask 255.255.255.0
	up iptables -A POSTROUTING -t nat -s 192.168.2.15/32 -j MASQUERADE
	up echo 1 &gt; /proc/sys/net/ipv4/ip_forward
        down iptables -D POSTROUTING -t nat -s 192.168.2.15/32 -j MASQUERADE
	down echo 0 &gt; /proc/sys/net/ipv4/ip_forward
</pre>
<p>Now put your USB cable in the PC and in the N900 and on the host. To check that everything is set up properly you can run:
</p>
<pre>ifconfig n900
</pre>
<a name="Automatic_configuration_with_Ubuntu_9.10.2F10.04.2F11.10"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=8" title="Edit section: Automatic configuration with Ubuntu 9.10/10.04/11.10">edit</a>]</span> <span class="mw-headline"> Automatic configuration with Ubuntu 9.10/10.04/11.10 </span></h3>
<p>Note: this instructions should be fixed/improved:
</p><p>Create the file in /etc/udev/rules.d/99-nokia-n900.rules and put in the following lines:
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", ENV{ID_USB_DRIVER}=="cdc_ether", ENV{ID_MODEL}="N900__PC-Suite_Mode", ENV{ID_VENDOR}=="Nokia", NAME="n900"
SUBSYSTEM=="net", ACTION=="add", ENV{ID_USB_DRIVER}=="cdc_phonet", ENV{ID_MODEL}="N900__PC-Suite_Mode", ENV{ID_VENDOR}=="Nokia", NAME="n900pn"
</pre>
<p>Then edit <code>/etc/network/interfaces</code> and add:
</p>
<pre>auto n900
iface n900 inet static
	address 192.168.2.14
	netmask 255.255.255.0
	up iptables -A POSTROUTING -t nat -s 192.168.2.15/32 -j MASQUERADE
	up echo 1 &gt; /proc/sys/net/ipv4/ip_forward
        down iptables -D POSTROUTING -t nat -s 192.168.2.15/32 -j MASQUERADE
	down echo 0 &gt; /proc/sys/net/ipv4/ip_forward
</pre>
<p><strong>For Ubuntu 11.10</strong>, put these lines to /etc/udev/rules.d/99-nokia-n900.rules
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer}=="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="usb0", RUN+="/sbin/ifconfig usb0 192.168.2.14 up", RUN+="/sbin/iptables -A POSTROUTING -t nat -s 192.168.2.15/32 -j MASQUERADE"
</pre>
<p>and don't modify <code>/etc/network/interfaces</code> in the way above, because you will make the boot slow with the message "waiting for network configuration". But for forwarding you should add to <code>/etc/sysctl.conf</code>
</p>
<pre>net.ipv4.ip_forward=1
</pre>
<p>The Network Manager on Ubuntu 11.10 won't auto detect this <code>usb0</code> interface, you will have to check it via <code>ping</code> or via Network Tools.
</p><p><strong>For Ubuntu 11.04</strong>, just plug the USB cable in, with already-configured N900,the Network Manager will auto handle <code>usb0</code> interface.
</p><p><strong>For Ubuntu 9.10 (NOT 10.04)</strong> you have to fix <code>/etc/init/network-interface.conf</code>, change the line:
</p>
<pre>stop on net-device-removed INTERFACE=$INTERFACE
</pre>
<p>with:
</p>
<pre>stop on net-device-remove INTERFACE=$INTERFACE
</pre>
<p>(Note the difference: net-device-remove<b>d</b>)
</p><p><strong>For all versions:</strong> You have to reload udev rules with:
</p>
<pre>udevadm control --reload-rules
</pre>
<p>You have to restart NetworkManager so it re-reads the interfaces file (otherwise it'll clobber your network device):
</p>
<pre>sudo /etc/init.d/network-manager restart
</pre>
<p>or
</p>
<pre>sudo service network-manager restart
</pre>
<p>Now put your USB cable in the PC and in the N900.
</p><p>If you are unable to autoconnect through the networking applet, you may need to manually bring up the interface:
</p>
<pre>ifup n900
</pre>
<p>If all went fine:
</p>
<ul><li> you should see with <code>ifconfig -a</code> two new network interfaces, n900 and n900pn, the first one configured with the proper ip address 192.168.2.15, and should be able to ping the N900.
</li><li> the N900 should be able to use the PC internet connection immediately.
</li></ul>
<a name="Host_configuration_on_Archlinux_via_netcfg"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=9" title="Edit section: Host configuration on Archlinux via netcfg">edit</a>]</span> <span class="mw-headline"> Host configuration on Archlinux via netcfg </span></h3>
<p>You will need to add the following lines into <code>/etc/network.d/N900</code>:
</p>
<pre>CONNECTION='ethernet'
DESCRIPTION='Nokia n900 maemo USB passthrough network'
INTERFACE='usb0'
IP='static'
ADDR='192.168.2.14'
# GATEWAY='192.168.2.14'
# DNS=('192.168.2.14')
# PRE_UP='  &lt;&lt; script loading of main module(s)! &gt;&gt;'
POST_UP='
         echo 1 &gt; /proc/sys/net/ipv4/ip_forward &amp;&amp;
         iptables -A POSTROUTING -t nat -s 192.168.2.0/24 -j MASQUERADE &amp;&amp;
         iptables -I INPUT -s 192.168.2.15 -j ACCEPT &amp;&amp;
         iptables -P FORWARD ACCEPT'
POST_DOWN='
         echo 0 &gt; /proc/sys/net/ipv4/ip_forward &amp;&amp;
         iptables -F &amp;&amp;
         iptables -t nat -F &amp;&amp;
         echo ":: Unloading cdc_ether" &amp;&amp;
         modprobe -r cdc_ether &amp;&amp;
         echo ":: Unloading cdc_phonet" &amp;&amp;
         modprobe -r cdc_phonet &amp;&amp;
         echo ":: Unloading usbnet" &amp;&amp;
         modprobe -r usbnet &amp;&amp;
         echo ":: Unloading phonet" &amp;&amp;
         modprobe -r phonet &amp;&amp;
         echo ":: Unloading cdc_acm" &amp;&amp;
         modprobe -r cdc_acm'
</pre>
<p>You need to also add these to udev if you are also using udev. Normally they go into <code>/etc/udev.d/rules/</code>:
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", ENV{ID_USB_DRIVER}=="cdc_ether", ENV{ID_MODEL}="N900__PC-Suite_Mode", ENV{ID_VENDOR}=="Nokia", NAME="usb0"
SUBSYSTEM=="net", ACTION=="add", ENV{ID_USB_DRIVER}=="cdc_phonet", ENV{ID_MODEL}="N900__PC-Suite_Mode", ENV{ID_VENDOR}=="Nokia", NAME="usb1"
</pre>
<p>Of course your entire configuration does not exactly have to be like this, it is only a rough guide.
</p><p>If you don't use netcfg, you can have the udev rule directly configure the interface with e.g. <code>/etc/udev/rules.d/99-nokia-n900.rules</code>:
</p>
<pre>SUBSYSTEM=="net", ACTION=="add", ATTRS{idVendor}=="0421", ATTRS{idProduct}=="01c8", ATTRS{manufacturer}=="Nokia", ATTRS{product}=="N900 (PC-Suite Mode)", NAME="n900", RUN+="/sbin/ifconfig n900 192.168.2.14"
</pre>
<p>This may even work with multiple USB devices connected, because it's matching on the vendor and product IDs rather than the interface name.
</p>
<a name="Windows"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=10" title="Edit section: Windows">edit</a>]</span> <span class="mw-headline"> Windows </span></h3>
<p>Windows USB networking does not work out of the box, but the old 770 workaround still works.
So follow these steps:
</p>
<ol><li> install the <a href="http://wiki.maemo.org/MADDE" title="MADDE">Mad Developer</a> application on N900 and start it and press "<b>Usb Networking</b>" -&gt; "<b>Windows Network</b>" -&gt; "<b>Close</b>".
</li><li> Press button "<b>Edit</b>" and enter following <b>IP Address:</b> 192.168.2.15, <b>Netmask:</b> 255.255.255.0, <b>Peer IP:</b> 192.168.2.14. and then press "<b>Configure</b>" (this address will be used for the SCP client as well).
</li><li> For Windows OS download <a href="http://tablets-dev.nokia.com/MADDE.php" class="external text" title="http://tablets-dev.nokia.com/MADDE.php" rel="nofollow">install-madde-0.6.72.exe</a>. Open file with <b>7-Zip</b> and extract somewhere (best to the desktop) files "<b>maemo_usbnet.inf</b>" and "<b>maemo_usbnet.cat</b>"
</li><li> Connect your N900 via USB and choose <b>PC Suite mode</b>. 
</li><li> PC will obtain drivers for new network device, just point it to the downloaded files. This will install network device "<b>Linux USB Ethernet/RNDIS Gadget</b>"
</li><li> Set for "Linux USB Ethernet/RNDIS Gadget" IP address <b>192.168.2.14</b>. 
</li><li> For Vista / Windows7 open "<b>Network and Sharing center</b>" and select "<b>Manage network connections</b>" (left menu) --&gt; right click on network device which have internet access and choose "<b>Properties</b>" --&gt; select <b>tab "Sharing"</b> --&gt; check box "<b>Allow other devices to connect...</b>" --&gt; under "<b>Home networking connection</b>" select the network connection (Local Area Connection n#) which is dedicated to "Linux USB Ethernet/RNDIS Gadget". 
</li><li> When you have finished USB Networking, to retrieve default state of N900 press in Mad Developer: "<b>Usb Networking</b>" -&gt; "<b>Unix Network</b>" -&gt; "<b>Close</b>".
</li></ol>
<a name="Mac_OS_X"></a><h3><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=11" title="Edit section: Mac OS X">edit</a>]</span> <span class="mw-headline"> Mac OS X </span></h3>
<p>OS X will detect a new network interface and ask you to configure it. Choose DHCP with manual address and set the IP address to 192.168.2.14
</p><p>To use the Internet connection of your Mac via USB networking make sure to enable System Preferences -&gt; Sharing -&gt; Internet sharing for the N900 interface <a href="http://docs.info.apple.com/article.html?path=Mac/10.5/en/8156.html" class="external text" title="http://docs.info.apple.com/article.html?path=Mac/10.5/en/8156.html" rel="nofollow">Howto</a>
</p>
<a name="One-time_Quick_.26_Dirty_Connection"></a><h2><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=12" title="Edit section: One-time Quick &amp; Dirty Connection">edit</a>]</span> <span class="mw-headline"> One-time Quick &amp; Dirty Connection </span></h2>
<p>If you just need a one-time connection quickly, with no need to edit configuration files or set things up for automatic detection/connection, then as an alternative to the above, the following has worked for this user (kwtm).  Make sure "usb-network-modules" and "rootsh" are installed (via Applications Manager or equivalent).
</p>
<ol>
<li>
connect the N900 to the Other Computer via USB cable, and select "PC Suite mode" when asked.
</li>
<li>
open a terminal on the N900 and type:
<pre>sudo gainroot
ifconfig usb0 192.168.2.15
ifconfig usb0 up
</pre>
</li>
<li>
on your Other Computer, open a terminal and type the following for Ubuntu; modify appropriately for other computers:
<pre>sudo ifconfig usb0 192.168.2.14
sudo ifconfig usb0 up
ssh -l user -v 192.168.2.15
</pre>
</li>
</ol>
<p>That is all. You should now be connected via terminal to your N900.  Whatever you type on your Other Computer, it will be as if you are typing on the N900 itself in a terminal. Non-Ubuntu Linux computers might not use the "sudo" command, so you will have to gain root another way.  One possibility that will probably work is to use the "su" command first, allowing you to omit "sudo" on the above commands:
</p>
<pre>su   # (And then enter the root password when asked)
ifconfig usb0 192.168.2.14
ifconfig usb0 up
exit # (This stops the root mode)
ssh -l user -v 192.168.2.15
</pre>
<p>[I have no idea what to do for Windows computers.  Perhaps someone can post the equivalent commands?]
</p>
<a name="Using_USB_networking_for_Maemo_applications"></a><h2><span class="editsection">[<a href="http://wiki.maemo.org/index.php?title=N900_USB_networking&amp;action=edit&amp;section=13" title="Edit section: Using USB networking for Maemo applications">edit</a>]</span> <span class="mw-headline"> Using USB networking for Maemo applications </span></h2>
<p>By default, standard network applications works well with USB networking, while Maemo-specific applications do not.
</p><p>Install <code>libicd-network-dummy</code> from Fremantle Nokia-binaries repository or better <code>libicd-network-null</code> from <a href="http://wiki.maemo.org/Extras-devel" title="Extras-devel">extras-devel</a>, and when USB networking is up pickup "Dummy network" from the connection manager. One way to do it:
</p>
<pre>apt-get install libicd-network-dummy
 or
apt-get install libicd-network-null
</pre>
<p>If the dummy network does not show up in the network manager you could run
the following commands in xterm:
</p>
<pre>gconftool-2 -s -t string /system/osso/connectivity/IAP/DUMMY/type DUMMY
gconftool-2 -s -t string /system/osso/connectivity/IAP/DUMMY/name "Dummy network"
</pre>
<p>and maybe
</p>
<pre>gconftool-2 -s -t string /system/osso/connectivity/IAP/DUMMY/autoconnect false
</pre>
<p>If connect automatically is used with "Any Connection", the phone will also use Dummy Network, which is not good. To prevent this, you need to run the following command&nbsp;:
</p>
<pre>gconftool -s /system/osso/connectivity/network_type/auto_connect -t list --list-type string "[WLAN_INFRA,GPRS]"
</pre>
<p>Keep in mind the above command will get overwritten if you change the value via UI. (If you choose any / wifi / gprs, and you will want to go back to "wifi or gprs" you will have to do the CLI thing again.
</p><p>Then restart icd2:
</p>
<pre>killall icd2
</pre>
<p>or reboot the device.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 123/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
#ifexist count: 0/100
-->

<!-- Saved in parser cache with key mediawiki-mw_:pcache:idhash:3045-0!1!0!!en!2 and timestamp 20120702154420 -->
<div class="printfooter">
Retrieved from "<a href="http://wiki.maemo.org/N900_USB_networking">http://wiki.maemo.org/N900_USB_networking</a>"</div>
			<div id="catlinks"><p class="catlinks"><a href="http://wiki.maemo.org/Special:Categories" title="Special:Categories">Categories</a>: <span dir="ltr"><a href="http://wiki.maemo.org/Category:Wiki_page_of_the_day" title="Category:Wiki page of the day">Wiki page of the day</a></span> | <span dir="ltr"><a href="http://wiki.maemo.org/Category:Connectivity" title="Category:Connectivity">Connectivity</a></span> | <span dir="ltr"><a href="http://wiki.maemo.org/Category:N900" title="Category:N900">N900</a></span> | <span dir="ltr"><a href="http://wiki.maemo.org/Category:USB" title="Category:USB">USB</a></span> | <span dir="ltr"><a href="http://wiki.maemo.org/Category:Power_users" title="Category:Power users">Power users</a></span></p></div>
			<!-- end content -->



                    </div><!-- /main-wrapper -->
                </div><!-- /main --><!-- content end -->

			<div class="visualClear"></div>

        <ul style="clear: left; float: left; display: inline; list-style-type: none;">
<li id="lastmod"> This page was last modified 07:07, 1 December 2011.</li><li id="viewcount">This page has been accessed 116,505 times.</li>      </ul>
			<div class="visualClear"></div>


			<div id="footer">
                <div id="footer-wrapper-left">
                    <div id="footer-wrapper-right">

			<ul>
                                <li class="first"><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">All Content CC</a></li>
                <li><a href="http://maemo.org/legal/">Legal</a></li>
                				<li class="privacy"><a href="http://wiki.maemo.org/maemo.org_wiki:Privacy_policy" title="maemo.org wiki:Privacy policy">Privacy policy</a></li>
				<li class="about"><a href="http://wiki.maemo.org/maemo.org_wiki:About" title="maemo.org wiki:About">About maemo.org wiki</a></li>
                <li>Powered by <a href="http://www.mediawiki.org/">MediaWiki</a></li>
			</ul>
                    </div>
                </div>
		</div>
		
	
		
</div>
<!-- Served in 0.257 secs. -->

        </div><!-- container -->

    

</body>
</html>
